<!DOCTYPE html>
<html>
  <body>
    <button id="run">Run</button>
    <div id="out"></div>

    <script type="module">
      import createModule from "./boggle.js";
      const Module = await createModule();
      const $ = (id) => document.getElementById(id);

      $("run").onclick = () => {
        let words = ["qu", "a", "t", "x", "c", "k"];
        let cols = 3;
        let rows = 2;


        const strPtrs = words.map((s) => {
          const nBytes = Module.lengthBytesUTF8(s) + 1; // +1 for null terminator
          const pStr = Module._malloc(nBytes);
          Module.stringToUTF8(s, pStr, nBytes);
          return pStr;
        });

        const n = strPtrs.length;
        const pArray = Module._malloc(n * 4); // 4 bytes per pointer in wasm32
        Module.HEAPU32.set(new Uint32Array(strPtrs), pArray >>> 2);

        Module._solveBoard(pArray, rows, cols);

        Module._free(pArray);
        for (const p of strPtrs) Module._free(p);

        console.log("The strings sent", words);
        console.log(new Date().toString());  
      };
    </script>
  </body>
</html>
